!function(a){function f(a){a+="";var b=a.charAt(0).toUpperCase();return b+a.substr(1)}function g(a,b){this.x=Math.round(parseFloat(a)),this.y=Math.round(parseFloat(b))}function h(a,b){this.width=Math.round(parseFloat(a)),this.height=Math.round(parseFloat(b))}function i(a,b,c){c="undefined"!=typeof c?c:1,this.x=parseFloat(a),this.y=parseFloat(b),this.z=parseFloat(c)}function j(c,d){var e=a(c).data(b);return e?e:(this.settings=a.extend({},j.defaultSettings,d),this.$target=a(c),this.mode="img"==this.$target.tagName()?"image":"container",this.imageUrl="image"==this.mode?this.$target.attr("src"):this.settings.imageUrl,this._init(),this.$target.data(b,this),"container"==this.mode&&this.$image.data(b,this),void 0)}var b="__apiz__",c="apiz-",d="apiz",e="apiz";String.prototype.ucfirst||(String.prototype.ucfirst=function(){return f(this)}),jQuery.fn.tagName=function(){return this.prop("tagName").toLowerCase()},j.prototype={_init:function(){var b=this;this.dragging=!1,this.pinching=!1,this.preventClickBecauseOfDragging=!1,this.preventClickForDoubleClick=!1,this._addWrapper(),this._updateCssClasses(),this.imageUrl?(this.$image=a("<img />"),this.$image.hide().prependTo(this.$wrapper).load(function(){b._obtainNaturalImageSize(),b._setup()}).error(function(){b._showError("Error loading image!"),b.disable()}).attr("src",this.imageUrl)):(this._showError("Invalid image url!"),this.disable())},_addWrapper:function(){this.$wrapper=a("<div></div>").addClass(c+"wrapper"),this.$overlay=a("<div></div>").addClass(c+"overlay").appendTo(this.$wrapper),this._addLoadingAnimation(),"image"==this.mode?(this.imageIsVisible=this.$target.is(":visible"),this.$target.hide().after(this.$wrapper).appendTo(this.$wrapper)):this.$wrapper.appendTo(this.$target)},_removeWrapper:function(){"image"==this.mode&&(this.$wrapper.after(this.$target),this.imageIsVisible&&this.$target.show()),this.$wrapper.remove()},_updateCssClasses:function(){"string"!=typeof this.settings.cssWrapperClass||this.$wrapper.hasClass(this.settings.cssWrapperClass)||this.$wrapper.addClass(this.settings.cssWrapperClass),this.$wrapper.hasClass(c+"mode-"+this.mode)||this.$wrapper.addClass(c+"mode-"+this.mode);var a={hammer:{status:this.settings.hammerPluginEnabled,enabled:"hammer-enabled",disabled:"hammer-disabled"},mouseWheel:{status:this.settings.mouseWheelPluginEnabled,enabled:"mouse-wheel-enabled",disabled:"mouse-wheel-disabled"},enabled:{status:!this.settings.disabled,enabled:"enabled",disabled:"disabled"},enableDragging:{status:this.settings.dragEnabled,enabled:"drag-enabled",disabled:"drag-disabled"},enableZooming:{status:this.settings.zoomEnabled,enabled:"zoom-enabled",disabled:"zoom-disabled"}};for(key in a){var b=a[key];this.$wrapper.removeClass(c+(b.status?b.disabled:b.enabled)).addClass(c+(b.status?b.enabled:b.disabled))}},_addLoadingAnimation:function(){var b;switch(this.settings.loadingAnimation){case"text":b=a("<div></div>").addClass(c+"loading-animation-text"),b.html(this.settings.loadingAnimationData);break;case"throbber":b=a("<div></div>").addClass(c+"throbber");var d=["one","two","three"];for(index in d)b.append(a("<div></div>").addClass(c+"circle "+c+"circle-"+d[index]));break;case"image":b=a("<div></div>").addClass(c+"loading-animation-image"),b.css("background-image","url('"+this.settings.loadingAnimationData+"')")}this._triggerHandler("beforeShowLoadingAnimation",[b])!==!1&&(this.$loadingAnimation=b,this.$wrapper.append(b).addClass(c+"loading-animation"),this._trigger("showLoadingAnimation"))},_removeLoadingAnimation:function(){var b=this;this.$loadingAnimation&&("number"==typeof this.settings.loadingAnimationFadeOutDuration?this.$loadingAnimation.fadeOut(this.settings.loadingAnimationFadeOutDuration,function(){a(this).remove(),b.$wrapper.removeClass(c+"loading-animation"),b._trigger("hideLoadingAnimation")}):(this.$loadingAnimation.remove(),this.$wrapper.removeClass(c+"loading-animation"),this._trigger("hideLoadingAnimation")),this.$loadingAnimation=void 0)},_obtainNaturalImageSize:function(){"image"==this.mode?this.$target:this.$image,this.naturalSize=new h(this.$image.width(),this.$image.height())},_setup:function(){this.currentPosition=new g(-1*this.naturalSize.width/2,-1*this.naturalSize.height/2),this.currentSize=new h(this.naturalSize.width,this.naturalSize.height),this.currentZoom=this._getValidZoom(1),this._resetZoom(),this._center(),this._bind(),this._removeLoadingAnimation(),"number"==typeof this.settings.loadingAnimationFadeOutDuration?this.$image.fadeIn(this.settings.loadingAnimationFadeOutDuration):this.$image.show(),this._trigger("init")},_bind:function(){var b=this;this.settings.hammerPluginEnabled&&"function"==typeof Hammer?(this.hammerManager=new Hammer.Manager(this.$overlay[0]),this.hammerManager.add(new Hammer.Pan({threshold:0,pointers:0})),this.hammerManager.add(new Hammer.Pinch({threshold:0})).recognizeWith(this.hammerManager.get("pan")),this.hammerManager.add(new Hammer.Swipe).recognizeWith(this.hammerManager.get("pan")),this.hammerManager.add(new Hammer.Tap({event:"doubletap",taps:2})),this.hammerManager.add(new Hammer.Tap),this.hammerManager.on("panstart panmove panend",function(a){b._onDrag(a)}),this.hammerManager.on("pinchstart pinchmove pinchend",function(a){b._onPinch(a)}),this.hammerManager.on("swipe",function(a){b._onSwipe(a)}),this.hammerManager.on("tap",function(a){b._onClick(a)}),this.hammerManager.on("doubletap",function(a){b._onDoubleClick(a)})):(this.$overlay.on("mousedown."+d,function(a){b._onDrag(a)}),a(document).on("mouseup."+d,function(a){b._onDrag(a)}),a(document).on("mousemove."+d,function(a){b._onDrag(a)}),this.$overlay.on("click."+d,function(a){b._onClick(a)}),this.$overlay.on("dblclick."+d,function(a){b._onDoubleClick(a)})),this.settings.mouseWheelPluginEnabled&&"function"==typeof jQuery.fn.mousewheel&&this.$overlay.mousewheel(function(a){return b._onMouseWheel(a),!1})},_unbind:function(){this.hammerManager?(this.hammerManager.stop(!0),this.hammerManager.destroy(),this._isDragging(!1),this._isPinching(!1)):(this.$overlay.off("mousedown."+d),a(document).off("mouseup."+d),a(document).off("mousemove."+d)),this.$overlay.off("mousewheel."+d)},_onDrag:function(a){if(!this.settings.disabled&&this.settings.dragEnabled){if("panstart"==a.type||"mousedown"==a.type)this._isDragging(!0),this.dragParams={imagePosition:this.currentPosition,cursorPosition:new g("panstart"==a.type?a.pointers[0].screenX:a.screenX,"panstart"==a.type?a.pointers[0].screenY:a.screenY)},"mousedown"==a.type&&(this.preventClickBecauseOfDragging=!1),this._trigger("dragStart",[this.currentPosition]);else if("panend"==a.type||"mouseup"==a.type)this._isDragging(!1),this._trigger("dragEnd",[this.currentPosition]);else if("panmove"==a.type||"mousemove"==a.type&&this._isDragging()){"mousemove"==a.type&&(this.preventClickBecauseOfDragging=!0);var b=new g(this.dragParams.imagePosition.x+("panmove"==a.type?a.pointers[0].screenX:a.screenX)-this.dragParams.cursorPosition.x,this.dragParams.imagePosition.y+("panmove"==a.type?a.pointers[0].screenY:a.screenY)-this.dragParams.cursorPosition.y);this._move(b),this._trigger("dragMove",[this.currentPosition])}a.preventDefault()}},_isDragging:function(a){return a!==!0&&a!==!1||this.dragging===a?this.dragging:(this.dragging=a,this.$wrapper.toggleClass(c+"dragging"),void 0)},_onPinch:function(a){if(!this.settings.disabled&&this.settings.zoomEnabled){if("pinchstart"==a.type){this._isPinching(!0);var b=new g(a.pointers[0].pageX||0,a.pointers[0].pageY||0),c=new g(a.pointers[1].pageX||0,a.pointers[1].pageY||0),d=new g((b.x+c.x)/2,(b.y+c.y)/2),e=new i((d.x-this.$image.offset().left)/this.currentSize.width,(d.y-this.$image.offset().top)/this.currentSize.height);this.pinchParams={zoom:this.currentZoom,imageSize:this.currentSize,imagePosition:this.currentPosition,relativeOrigin:e},this._trigger("pinchStart",[this.currentZoom,this.currentSize,this.currentPosition])}else if("pinchend"==a.type)this._isPinching(!1),this._trigger("pinchEnd",[this.currentZoom,this.currentSize,this.currentPosition]);else{var f=this.pinchParams.zoom*a.scale;this._zoomTo(f);var h=this.currentSize.width-this.pinchParams.imageSize.width,j=this.currentSize.height-this.pinchParams.imageSize.height,k=new g(this.pinchParams.imagePosition.x-h*this.pinchParams.relativeOrigin.x,this.pinchParams.imagePosition.y-j*this.pinchParams.relativeOrigin.y);this._move(k),this._trigger("pinchMove",[this.currentZoom,this.currentSize,this.currentPosition])}a.preventDefault()}},_isPinching:function(a){return a!==!0&&a!==!1||this.pinching===a?this.pinching:(this.pinching=a,this.$wrapper.toggleClass(c+"pinching"),void 0)},_onSwipe:function(a){if(!this.settings.disabled){var b;switch(a.direction){case 8:b="swipeTop";break;case 4:b="swipeRight";break;case 16:b="swipeBottom";break;case 2:b="swipeLeft"}b&&(this._handleAction(this.settings[b],a),this._trigger(b,[a]),a.preventDefault())}},_onClick:function(a){if(!(this.settings.disabled||this.preventClickBecauseOfDragging||this.preventClickForDoubleClick)){if("click"==a.type){var b=this;this.preventClickForDoubleClick=!0,this.preventClickTimeout=setTimeout(function(){b.preventClickForDoubleClick=!1,b.preventClickTimeout=void 0},500)}this._handleAction(this.settings.click,a),this._trigger("click",[a]),a.preventDefault()}},_onDoubleClick:function(a){this.settings.disabled||("dblclick"==a.type&&this.preventClickTimeout&&(this.preventClickForDoubleClick=!1,clearTimeout(this.preventClickTimeout),this.preventClickTimeout=void 0),this._handleAction(this.settings.doubleClick,a),this._trigger("doubleClick",[a]),a.preventDefault())},_onMouseWheel:function(a){if(!this.settings.disabled&&this.settings.zoomEnabled&&!this._isDragging()){var b=this.currentZoom+this.settings.zoomStep*a.deltaY,c=new i((a.pageX-this.$image.offset().left)/this.currentSize.width,(a.pageY-this.$image.offset().top)/this.currentSize.height);this._zoomTo(b,c),this._trigger("mouseWheel",[this.currentZoom,this.currentSize,this.currentPosition]),a.preventDefault()}},_handleAction:function(a,b,c){if("function"==typeof a)a.apply(this.$target,b);else switch(a){case"open":window.open(this.imageUrl);break;case"zoomIn":this.zoomIn(c);break;case"zoomOut":this.zoomOut(c);break;case"zoomMin":this.zoomMin(c);break;case"zoomMax":this.zoomMax(c);break;case"zoomToggle":this.zoomToggle(c)}},_getOverlaySize:function(){return new h(this.$overlay.width(),this.$overlay.height())},_zoomTo:function(a,b){if(this.settings.disabled||!this.settings.zoomEnabled)return!1;this.currentZoom;var d=this.currentPosition,e=this.currentSize;(a=this._getValidZoom(a))>=0&&(this.currentZoom=a,this.currentSize=new h(this.naturalSize.width*this.currentZoom,this.naturalSize.height*this.currentZoom),this.currentPosition=this._getValidPosition(new g(d.x-(this.currentSize.width-e.width)*(b?b.x:.5),d.y-(this.currentSize.height-e.height)*(b?b.y:.5))),this._updateSizeAndPosition())},_getValidZoom:function(a){var a=this._parseZoom(a),c=this._parseZoom(this.settings.minZoom),d=this._parseZoom(this.settings.maxZoom);return a!==!1?(c!==!1&&(a=Math.max(a,c)),d!==!1&&(a=Math.min(a,d))):a=-1,a},_parseZoom:function(a,b){if("number"==typeof a)return a;if("string"==typeof a){var c=a.indexOf("%");if(c>0&&c==a.length-1)return a=a.substr(0,c)/100;if("contain"==a||"cover"==a){var d=this._getOverlaySize(),e=d.width/this.naturalSize.width,f=d.height/this.naturalSize.height;return a="contain"==a?Math.min(e,f):Math.max(e,f)}}return b?b:!1},_resetZoom:function(){var a;if("number"==typeof this.settings.initialZoom||this.settings.initialZoom==parseFloat(this.settings.initialZoom))a=parseFloat(this.settings.initialZoom);else if("string"==typeof this.settings.initialZoom)switch(this.settings.initialZoom){case"auto":case"contain":a=this._getValidZoom("contain");break;case"cover":a=this._getValidZoom("cover");break;case"min":a=this._parseZoom(this.settings.minZoom);break;case"max":a=this._parseZoom(this.settings.maxZoom);break;default:a=this._getValidZoom(this.settings.initialZoom)}a&&(this._zoomTo(a),this._trigger("resetZoom",[this.currentZoom,this.currentSize]))},_move:function(a){var b=this._getValidPosition(a);return this._triggerHandler("beforePositionChange",[b])===!1?!1:(this.currentPosition=b,this._updateSizeAndPosition(),this._trigger("positionChanged",[this.currentPosition]),!0)},_getValidPosition:function(b){var d,e,c=this._getOverlaySize();return d=this.currentSize.width<=c.width?a.inArray(this.settings.autoCenter,[!0,"both","x","h","horizontal"])>-1?-1*this.currentSize.width/2:Math.min(Math.max(0-c.width/2,b.x),c.width/2-this.currentSize.width):Math.max(Math.min(0-c.width/2,b.x),c.width/2-this.currentSize.width),d=Math.round(d),e=this.currentSize.height<=c.height?a.inArray(this.settings.autoCenter,[!0,"both","y","v","vertical"])>-1?-1*this.currentSize.height/2:Math.min(Math.max(0-c.height/2,b.y),c.height/2-this.currentSize.height):Math.max(Math.min(0-c.height/2,b.y),c.height/2-this.currentSize.height),e=Math.round(e),new g(d,e)},_center:function(a){var b=new g(this.currentPosition.x,this.currentPosition.y);switch(a){case"x":case"h":case"horizontal":b.x=-1*this.currentSize.width/2;break;case"y":case"v":case"vertical":b.y=-1*this.currentSize.height/2;break;default:b=new g(-1*this.currentSize.width/2,-1*this.currentSize.height/2)}this._move(b),this._trigger("center",[this.currentPosition])},_updateSizeAndPosition:function(){if(this.settings.hardwareAcceleration){var a="matrix3d("+this.currentZoom+", 0, 0, 0, 0, "+this.currentZoom+", 0, 0, 0, 0, "+this.currentZoom+", 0, "+this.currentPosition.x+", "+this.currentPosition.y+", 0, 1)";this.$image.css({"-webkit-transform":a,"-moz-transform":a,"-ms-transform":a,"-o-transform":a,transform:a})}else{var b=Math.round(this.naturalSize.width*this.currentZoom)+"px",c=Math.round(this.naturalSize.height*this.currentZoom)+"px",d=this.currentPosition.x+"px",e=this.currentPosition.y+"px";this.$image.css({width:b,height:c,marginLeft:d,marginTop:e})}},_trigger:function(a,b,c){var d="on"+a.ucfirst(),f=this.settings[d];c=c?c:this.$target,"function"==typeof f&&f.apply(c,b),a=e+a.ucfirst(),c.trigger(a,b)},_triggerHandler:function(a,b,c){var h,d="on"+a.ucfirst(),f=this.settings[d],g=void 0;return c=c?c:this.$target,"function"==typeof f&&(g=f.apply(c,b)),a=e+a.ucfirst(),h=void 0!==(h=c.triggerHandler(a,b))?h:g},_showError:function(b){this.$errorMessage||(this.$errorMessage=a("<div></div>").addClass(c+"error-message"),this.$wrapper.append(this.$errorMessage)),this.$loadingAnimation&&this.$loadingAnimation.remove(),this.$wrapper.addClass(c+"error"),this.$errorMessage.html(b),this._trigger("error",b)},enable:function(){this.settings.disabled=!1,this._updateCssClasses()},disable:function(){this.settings.disabled=!0,this._updateCssClasses(),this.hammerManager&&(this.hammerManager.stop(!0),this._isDragging(!1),this._isPinching(!1))},isDisable:function(){return this.settings.disabled},isDragging:function(){return this._isDragging()},isPinching:function(){return this._isPinching},size:function(){return this.currentSize},position:function(){return this.currentPosition},reset:function(){this._resetZoom(),this._center()},resetSize:function(){this._resetZoom()},center:function(a){this._center(a)},zoom:function(a,b){return a&&this._zoomTo(a,b),a=Math.round(1e5*this.currentZoom)/1e5},zoomIn:function(a){var b=this.currentZoom+this.settings.zoomStep;this._zoomTo(b,a)},zoomOut:function(a){var b=this.currentZoom-this.settings.zoomStep;this._zoomTo(b,a)},zoomMin:function(a){this._zoomTo(this.settings.minZoom,a)},zoomMax:function(a){this._zoomTo(this.settings.maxZoom,a)},zoomToggle:function(a){this.isMaxZoomed()?(this._resetZoom(),this._center()):this._zoomTo(this.settings.maxZoom,a)},isMinZoomed:function(){var a=this._parseZoom(this.settings.minZoom);return"number"==typeof a?Math.abs(this.currentZoom-a)<1e-5:!1},isMaxZoomed:function(){var a=this._parseZoom(this.settings.maxZoom);return"number"==typeof a?Math.abs(a-this.currentZoom)<1e-5:!1},option:function(b,c){if(!b)return a.extend({},this.settings);var d;if("string"==typeof b){if(1===arguments.length)return void 0!==this.settings[b]?this.settings[b]:null;d={},d[b]=c}else d=b;this._setOptions(d)},_setOptions:function(b){for(key in b){var c=b[key];switch(key){case"hammerPluginEnabled":case"mouseWheelPluginEnabled":this._unbind();break;case"disabled":case"dragEnabled":case"zoomEnabled":this.hammerManager&&this.hammerManager.stop(!0),this._isDragging(!1),this._isPinching(!1);break;case"cssWrapperClass":this.$wrapper.removeClass(this.settings.cssWrapperClass);break;case"hardwareAcceleration":this.$image.css({"-webkit-transform":"","-moz-transform":"","-ms-transform":"","-o-transform":"",transform:"",width:"",height:"",marginLeft:"",marginTop:""})}switch(this.settings[key]=c,key){case"hammerPluginEnabled":case"mouseWheelPluginEnabled":this._bind();break;case"hardwareAcceleration":this._updateSizeAndPosition();break;case"minZoom":case"maxZoom":this._zoomTo(this.currentZoom);break;case"autoCenter":switch(c){case!0:case"both":this._center();break;case"x":case"h":case"horizontal":case"y":case"v":case"vertical":this._center(c)}}a.inArray(key,["cssWrapperClass"])>-1&&this._updateCssClasses()}},destroy:function(){this._trigger("destroy"),this._unbind(),this._removeWrapper(),this._isDragging(!1),this._isPinching(!1),this.$target.removeData(b),"container"==this.mode&&this.$image.removeData(b)}},a.fn.apImageZoom=function(c){if("string"==typeof c){var d,e,g=[],h=Array.prototype.slice.call(arguments,1);return this.each(function(){if(d=a(this).data(b)){if("function"==typeof(e=d[c])&&"_"!==c.charAt(0)){var f=e.apply(d,h);void 0!==f&&g.push(f)}}else g.push(void 0)}),g.length?1===g.length?g[0]:g:this}return this.each(function(){new j(this,c)})},j.defaultSettings={imageUrl:void 0,loadingAnimation:void 0,loadingAnimationData:void 0,loadingAnimationFadeOutDuration:200,cssWrapperClass:void 0,initialZoom:"auto",minZoom:.2,maxZoom:1,zoomStep:.07,autoCenter:!0,hammerPluginEnabled:!0,mouseWheelPluginEnabled:!0,hardwareAcceleration:!0,disabled:!1,dragEnabled:!0,zoomEnabled:!0,doubleClick:"zoomToggle"}}(jQuery);