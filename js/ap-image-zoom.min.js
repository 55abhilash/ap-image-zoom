!function(a){function d(a){a+="";var b=a[0].toUpperCase();return b+a.substr(1)}function e(a,b){this.x=Math.round(parseFloat(a)),this.y=Math.round(parseFloat(b))}function f(a,b){this.width=Math.round(parseFloat(a)),this.height=Math.round(parseFloat(b))}function g(a,b,c){c="undefined"!=typeof c?c:1,this.x=parseFloat(a),this.y=parseFloat(b),this.z=parseFloat(c)}function h(c,d){var e=a(c).data(b);return e?e:(this.$image=a(c),this.settings=a.extend({},h.defaultSettings,d),this._init(),this.$image.data(b,this),void 0)}var b="__apiz__",c="apiz-";String.prototype.ucfirst||(String.prototype.ucfirst=function(){return d(this)}),h.prototype={_init:function(){var b=this;this.panning=!1,this.pinching=!1,this.originSize=new f(this.$image.width(),this.$image.height()),this.originStyle=this.$image.attr("style"),this.$image.removeAttr("style"),this._wrapImage(),this._setCssClasses(),a("<img />").hide().appendTo("body").load(function(){b.naturalSize=new f(a(this).width(),a(this).height()),b._setConstraints(),b._setup(),a(this).remove()}).error(function(){b._showError("Error loading image!"),b.$loadingAnimation&&b.$loadingAnimation.remove()}).attr("src",this.$image.attr("src"))},_wrapImage:function(){this.$wrapper=a("<div></div>").addClass(c+"wrapper"),this.$overlay=a("<div></div>").addClass(c+"overlay"),this.$wrapper.append(this.$overlay),this._addLoadingAnimation();var b=this.$image.attr("id");b&&this.$wrapper.attr("id",c+b),this.$image.hide().after(this.$wrapper).prependTo(this.$wrapper)},_addLoadingAnimation:function(){var b;switch(this.settings.loadingAnimation){case"text":b=a("<div></div>").addClass(c+"loading-animation-text"),b.html(this.settings.loadingAnimationData);break;case"throbber":b=a("<div></div>").addClass(c+"throbber");var d=["one","two","three"];for(index in d)b.append(a("<div></div>").addClass(c+"circle "+c+"circle-"+d[index]));break;case"image":b=a("<div></div>").addClass(c+"loading-animation-image"),b.css("background-image","url('"+this.settings.loadingAnimationData+"')")}b&&(this.$loadingAnimation=b,this.$wrapper.append(b))},_setup:function(){this._resetSize(),this._center(),this._bind(),this.$loadingAnimation&&this.$loadingAnimation.fadeOut(200,function(){a(this).remove()}),this.$image.fadeIn(200),this._trigger("init")},_unwrap:function(){this.$wrapper.after(this.$image).remove()},_setCssClasses:function(){"string"==typeof this.settings.cssWrapperClass&&this.$wrapper.addClass(this.settings.cssWrapperClass);var a={hammer:{status:!this.settings.disableHammerPlugin,enabled:"hammer-enabled",disabled:"hammer-disabled"},mouseWheel:{status:!this.settings.disableMouseWheelPlugin,enabled:"mouse-wheel-enabled",disabled:"mouse-wheel-disabled"},enabled:{status:!this.settings.disabled,enabled:"enabled",disabled:"disabled"},panEnabled:{status:!this.settings.disablePan,enabled:"pan-enabled",disabled:"pan-disabled"},zoomEnabled:{status:!this.settings.disableZoom,enabled:"zoom-enabled",disabled:"zoom-disabled"}};for(key in a){var b=a[key];this.$wrapper.removeClass(c+(b.status?b.disabled:b.enabled)).addClass(c+(b.status?b.enabled:b.disabled))}},_bind:function(){var a=this;this.settings.disableHammerPlugin||"function"!=typeof Hammer||(this.hammerManager=new Hammer.Manager(this.$overlay[0]),this.hammerManager.add(new Hammer.Pan({threshold:0,pointers:0})),this.hammerManager.add(new Hammer.Pinch({threshold:0})).recognizeWith(this.hammerManager.get("pan")),this.hammerManager.add(new Hammer.Swipe).recognizeWith(this.hammerManager.get("pan")),this.hammerManager.add(new Hammer.Tap({event:"doubletap",taps:2})),this.hammerManager.add(new Hammer.Tap),this.hammerManager.on("panstart panmove panend",function(b){a._onPan(b)}),this.hammerManager.on("pinchstart pinchmove pinchend",function(b){a._onPinch(b)}),this.hammerManager.on("swipe",function(b){a._onSwipe(b)}),this.hammerManager.on("tap",function(b){a._onTap(b)}),this.hammerManager.on("doubletap",function(b){a._onDoubleTap(b)})),this.settings.disableMouseWheelPlugin||"function"!=typeof jQuery.fn.mousewheel||this.$overlay.on("mousewheel",function(b){a._onMouseWheel(b)})},_unbind:function(){this.hammerManager&&(this.hammerManager.stop(!0),this.hammerManager.destroy(),this._isPanning(!1),this._isPinching(!1)),this.$overlay.unbind("mousewheel")},_onPan:function(a){if(!this.settings.disabled&&!this.settings.disablePan){if("panstart"==a.type)this._isPanning(!0),this.panStart={imagePosition:this._imagePosition(),cursorPosition:new e(a.pointers[0].screenX,a.pointers[0].screenY)},this._trigger("panstart",[this.panStart.imagePosition]);else if("panend"==a.type)this._isPanning(!1),this.$wrapper.removeClass(c+"is-panning"),this._trigger("panend",[this._imagePosition()]);else{var b=new e(this.panStart.imagePosition.x+(a.pointers[0].screenX-this.panStart.cursorPosition.x),this.panStart.imagePosition.y+(a.pointers[0].screenY-this.panStart.cursorPosition.y)),d=this._move(b);this._trigger("panmove",[d])}a.preventDefault()}},_onPinch:function(a){if(!this.settings.disabled&&!this.settings.disableZoom){if("pinchstart"==a.type){this._isPinching(!0);var b=new e(a.pointers[0].pageX||0,a.pointers[0].pageY||0),c=new e(a.pointers[1].pageX||0,a.pointers[1].pageY||0),d=new e((b.x+c.x)/2,(b.y+c.y)/2),h=this._imageSize(),i=new g((d.x-this.$image.offset().left)/h.width,(d.y-this.$image.offset().top)/h.height);this.pinchStart={imageSize:h,imagePosition:this._imagePosition(),relativeOrigin:i},this._trigger("pinchstart",[h,this.pinchStart.imagePosition])}else if("pinchend"==a.type)this._isPinching(!1),this._trigger("pinchend",[this._imageSize(),this._imagePosition()]);else{var j=new f(this.pinchStart.imageSize.width*a.scale,this.pinchStart.imageSize.height*a.scale),k=this._resize(j);if(k.width>-1){var l=k.width-this.pinchStart.imageSize.width,m=k.height-this.pinchStart.imageSize.height,n=new e(this.pinchStart.imagePosition.x-l*this.pinchStart.relativeOrigin.x,this.pinchStart.imagePosition.y-m*this.pinchStart.relativeOrigin.y),o=this._move(n);this._trigger("pinchmove",[k,o])}}a.preventDefault()}},_onSwipe:function(a){if(!this.settings.disabled){var b;switch(a.direction){case 8:b="swipetop";break;case 4:b="swiperight";break;case 16:b="swipebottom";break;case 2:b="swipeleft"}b&&(this._trigger(b,[a]),a.preventDefault())}},_onTap:function(a){this.settings.disabled||(this._trigger("tap",[a]),a.preventDefault())},_onDoubleTap:function(a){if(!this.settings.disabled){var b,c=this._imageSize();switch(this.settings.doubleTap){case"open":var d=this.$image.attr("src");window.open(d);break;case"zoomMax":b=this.settings.maxZoom;break;case"zoomToggle":c.width==this.sizeConstraints.width.max?(this._resetSize(),this._center()):b=this.settings.maxZoom}if(b){var e=new g((a.pointers[0].pageX-this.$image.offset().left)/c.width,(a.pointers[0].pageY-this.$image.offset().top)/c.height);this._zoomTo(b,e)}this._trigger("doubletap",[a]),a.preventDefault()}},_onMouseWheel:function(a){if(!(this.settings.disabled||this.settings.disableZoom||this._isPinching())){var b=this._getZoom()+this.settings.zoomStep*a.deltaY,c=this._imageSize(),d=new g((a.pageX-this.$image.offset().left)/c.width,(a.pageY-this.$image.offset().top)/c.height),e=this._zoomTo(b,d);this._trigger("mousewheel",[e.size,e.position]),a.preventDefault()}},_setConstraints:function(){this.sizeConstraints={width:{min:this.naturalSize.width*this.settings.minZoom,max:this.naturalSize.width*this.settings.maxZoom},height:{min:this.naturalSize.height*this.settings.minZoom,max:this.naturalSize.height*this.settings.maxZoom}}},_resetSize:function(){var a=this.originSize;if("string"==typeof this.settings.initialSize)switch(this.settings.initialSize){case"auto":a=this._getAutoFitSize();break;case"min":a=new f(this.sizeConstraints.width.min,this.sizeConstraints.height.min);break;case"max":a=new f(this.sizeConstraints.width.max,this.sizeConstraints.height.max)}var b=this._resize(a);this._trigger("resetSize",[b])},_getAutoFitSize:function(){var a=this._overlaySize(),b=this._imageSize(),c=a.width/a.height>1;return size=c?new f(b.width*(a.height/b.height),a.height):new f(a.width,b.height*(a.width/b.width))},_center:function(a){var b=this._imageSize(),c=this._overlaySize(),d=this._imagePosition();switch(a){case"x":case"horizontal":d.x=(c.width-b.width)/2;break;case"y":case"vertical":d.y=(c.height-b.height)/2;break;default:d=new e((c.width-b.width)/2,(c.height-b.height)/2)}var f=this._move(d);this._trigger("center",[f])},_move:function(a){var b=this,c=this._overlaySize(),d=this._imageSize();if(d.width<=c.width){var f=Math.min(Math.max(0,a.x),c.width-d.width);(1==b.settings.autoCenter||"both"==b.settings.autoCenter||"horizontal"==b.settings.autoCenter)&&(f=Math.round((c.width-d.width)/2))}else var f=Math.max(Math.min(0,a.x),c.width-d.width);if(d.height<=c.height){var g=Math.min(Math.max(0,a.y),c.height-d.height);(1==b.settings.autoCenter||"both"==b.settings.autoCenter||"vertical"==b.settings.autoCenter)&&(g=Math.round((c.height-d.height)/2))}else var g=Math.max(Math.min(0,a.y),c.height-d.height);var h=new e(f,g);return this._triggerHandler("beforePositionChange",[h])===!1?new e(-1,-1):(this._imagePosition(h),this._trigger("positionChanged",[h]),h)},_resize:function(a){var b=new f(Math.max(Math.min(a.width,this.sizeConstraints.width.max),this.sizeConstraints.width.min),Math.max(Math.min(a.height,this.sizeConstraints.height.max),this.sizeConstraints.height.min));return this._triggerHandler("beforeSizeChange",[b])===!1?new f(-1,-1):(this._imageSize(b),this._trigger("sizeChanged",[b]),b)},_overlaySize:function(){return new f(this.$overlay.width(),this.$overlay.height())},_imageSize:function(a){return a?(this.$image.width(a.width),this.$image.height(a.height),void 0):new f(this.$image.width(),this.$image.height())},_imagePosition:function(a){if(!a)return new e(this.$image.offset().left-this.$overlay.offset().left,this.$image.offset().top-this.$overlay.offset().top);var b=this._overlaySize(),c=a.x-Math.round(b.width/2),d=a.y-Math.round(b.height/2);this.$image.css({marginLeft:c,marginTop:d})},_isPanning:function(a){return a!==!0&&a!==!1||this.panning===a?this.panning:(this.panning=a,this.$wrapper.toggleClass(c+"is-panning"),void 0)},_isPinching:function(a){return a!==!0&&a!==!1||this.pinching===a?this.pinching:(this.pinching=a,this.$wrapper.toggleClass(c+"is-pinching"),void 0)},_getZoom:function(){return this._imageSize().width/this.naturalSize.width},_zoomTo:function(a,b){if(this.settings.disabled||this.settings.disableZoom)return!1;var c=this._imageSize(),d=this.naturalSize.width*a,h=parseInt(d/c.width*c.height),i=this._resize(new f(d,h)),j=void 0;if(i.width>-1){b||(b=new g(.5,.5));var k=i.width-c.width,l=i.height-c.height,m=this._imagePosition(),n=new e(m.x-k*b.x,m.y-l*b.y);j=this._move(n)}return{size:i,position:j}},_trigger:function(a,b){var c="on"+a.ucfirst();if("function"==typeof this.settings[c]){var d=this.settings[c];d.apply(this.$image,b)}this.$image.trigger(a,b)},_triggerHandler:function(a,b){var e,c="on"+a.ucfirst(),d=void 0;if("function"==typeof this.settings[c]){var f=this.settings[c];d=f.apply(this.$image,b)}return e=void 0!==(e=this.$image.triggerHandler(a,b))?e:d},_showError:function(b){this.$errorMessage||(this.$errorMessage=a("<div></div>").addClass(c+"error"),this.$wrapper.append(this.$errorMessage)),this.$errorMessage.html(b)},enable:function(){this.settings.disabled=!1,this._setCssClasses()},disable:function(){this.settings.disabled=!0,this._setCssClasses(),this.hammerManager&&(this.hammerManager.stop(!0),this._isPanning(!1),this._isPinching(!1))},isDisable:function(){return this.settings.disabled},isPanning:function(){return this._isPanning()},isPinching:function(){return this._isPinching},size:function(){return this._imageSize()},position:function(){return this._imagePosition()},reset:function(){this._resetSize(),this._center()},resetSize:function(){this._resetSize()},center:function(a){this._center(a)},zoom:function(a,b){if(!a){var a=this._getZoom();return Math.round(1e3*a)/1e3}this._zoomTo(a,b)},zoomIn:function(a){var b=this._getZoom()+this.settings.zoomStep;return this._zoomTo(b,a)},zoomOut:function(a){var b=this._getZoom()-this.settings.zoomStep;return this._zoomTo(b,a)},option:function(b,c){if(!b)return a.extend({},this.settings);var d;if("string"==typeof b){if(1===arguments.length)return void 0!==this.settings[b]?this.settings[b]:null;d={},d[b]=c}else d=b;this._setOptions(d),this._setCssClasses()},_setOptions:function(b){for(key in b){var c=b[key];if(a.inArray(key,["disableHammerPlugin","disableMouseWheelPlugin"])>-1?this._unbind():a.inArray(key,["disabled","disablePan","disableZoom"])>-1&&this.hammerManager?this.hammerManager.stop(!0):"cssWrapperClass"==key&&"string"==typeof this.settings.cssWrapperClass&&this.$wrapper.removeClass(this.settings.cssWrapperClass),this.settings[key]=c,a.inArray(key,["disableHammerPlugin","disableMouseWheelPlugin"])>-1)this._bind();else if(a.inArray(key,["disabled","disablePan","disableZoom"])>-1&&this.hammerManager)this.hammerManager.stop(!0);else if("cssWrapperClass"==key&&"string"==typeof this.settings.cssWrapperClass)this.$wrapper.addClass(this.settings.cssWrapperClass);else if(a.inArray(key,["minZoom","maxZoom"])>-1){this._setConstraints();var d=this._getZoom();this._zoomTo(d)}else if("autoCenter"==key)switch(c){case!0:case"both":this._center();break;case"horizontal":case"vertical":this._center(c)}}},destroy:function(){this.$image.trigger("destroy"),this._unbind(),this._unwrap(),this.$image.removeAttr("style").attr("style",this.originStyle),this._imageSize(this.originSize),this._isPanning(!1),this._isPinching(!1),this.$image.removeData(b)}},a.fn.apImageZoom=function(c){if("string"==typeof c){var d,e,g=[],i=Array.prototype.slice.call(arguments,1);return this.each(function(){if(d=a(this).data(b)){if("function"==typeof(e=d[c])&&"_"!==c.charAt(0)){var f=e.apply(d,i);void 0!==f&&g.push(f)}}else g.push(void 0)}),g.length?1===g.length?g[0]:g:this}return this.each(function(){new h(this,c)})},h.defaultSettings={disableHammerPlugin:!1,disableMouseWheelPlugin:!1,disabled:!1,disablePan:!1,disableZoom:!1,loadingAnimation:void 0,loadingAnimationData:void 0,initialSize:"auto",cssWrapperClass:void 0,minZoom:.2,maxZoom:1,zoomStep:.1,autoCenter:!0,doubleTap:void 0,onBeforeSizeChange:void 0,onSizeChanged:void 0,onBeforePositionChange:void 0,onPositionChanged:void 0}}(jQuery);